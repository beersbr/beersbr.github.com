
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dynamic Lighting in 2d - BrettBeers</title>
  <meta name="author" content="Brett Beers">

  
  <meta name="description" content="A quick primer on what is needed So here is my writeup on dynamic lighting in 2d. I am using javascript for this write up but the code should be easy &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://beersbr.github.com/blog/2011/12/06/dynamic-lighting-in-2d">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="BrettBeers" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">BrettBeers</a></h1>
  
    <h2>Programming noob... working on being less of a noob</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:beersbr.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Dynamic Lighting in 2d</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-06T16:38:00-07:00" pubdate data-updated="true">Dec 6<span>th</span>, 2011</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h3>A quick primer on what is needed</h3>

<p>So here is my writeup on dynamic lighting in 2d. I am using javascript for this write up but the code should be easy enough to transpose it to another language. No time to waste. Let&#8217;s get started.</p>

<h3>Vectors</h3>

<p>Vectors are defined by <a href="https://www.google.com/search?gcx=w&amp;ie=UTF-8&amp;q=define%3A+vector">google</a> as: <em>A quantity having direction as well as magnitude, esp. as determining the position of one point in space relative to another.</em>
And that is pretty much how we are going to define them in the code.</p>

<figure class='code'><figcaption><span>vector_object</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">Vector</span><span class="p">(</span><span class="nx">p</span><span class="p">){</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">magnitude</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span> <span class="c1">// Use the pathagorean theorem to get the magnitude.</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>There we have a position and magnitude. We will get to the direction part a little bit later but for now this will do. Now why are vectors useful? Let&#8217;s take a look at some operations we can perform on vectors.</p>

<h4>Addition</h4>

<p>Vector addition on a coordinate system is actually very easy. If we have two vectors <em>v</em>A(2, -4) and <em>v</em>B(3, 9) we can add them by simply adding their parts. Ergo the sum of <em>v</em>A + <em>v</em>B would be <em>v</em>(2+3, -4+9). Usually vectors have three numbers, x coord, y coord and z coord, since we are not in 3d space we only have two. To get the magnitude we always assume, at least for our purposes, that the vector starts at the origin. That is the point (0, 0) or the top left hand part of the screen in the canvas 2d space.</p>

<p>One of the things I do quite often in the code is move the origin of a vector by just adding the parts of the vector and not the magnitude. That way we get a vector with a specific point of origin.</p>

<h4>The direction part of a vector</h4>

<p>Earlier when I wrote the definition of a vector there was a little part about direction. This is actually one of the most important parts of the vector as far as how we are doing are lighting. More importantly we want the angle between two vectors.</p>

<p><img src="/images/angle_between.png" alt="angle between" /></p>

<p>We want the angle denoted by the black curve inbetween vector A and vector B. We can get that using what is called the <a href="http://en.wikipedia.org/wiki/Dot_product">Dot Product</a>. In short it gives us the cosine angle between two vectors. We use this to determine which parts of an object are facing us.</p>

<p>Here is what my dot product function looks like:</p>

<figure class='code'><figcaption><span>dot_product</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">DotProduct2</span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span> <span class="nx">v2</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">((</span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">v1</span><span class="p">.</span><span class="nx">magnitude</span><span class="o">*</span><span class="nx">v2</span><span class="p">.</span><span class="nx">magnitude</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">c</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>There is not a whole lot to it. We take the parts of our two vectors and multiply them individually and then add the parts and divide by the sum of the product of the magnitudes. This will give us a cosine angle. Once we have the angle between two vectors say a light and a side we can do a check to see whether the cosine is greater than or less than 0. You can see that in the picture below.</p>

<p><img src="/images/cosine.png" alt="Cosine circle" /></p>

<h3>The other parts&#8230; or the OO parts</h3>

<p>Now we need a way to handle a light emmiting object and an object that blocks light so we can cast shadows. We will call them blocks and lights. Clever right?</p>

<h4>Blocks</h4>

<p>For handling blocks we are going to use a list of vertecies to make convex shapes. Then we will need a way to draw that to the canvas. And maybe a way to move the objects. Here is my go at it.</p>

<figure class='code'><figcaption><span>block</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">Block</span><span class="p">(</span><span class="nx">p</span><span class="p">){</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">verts</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">verts</span> <span class="o">||</span> <span class="p">[];</span> <span class="c1">// [v1, v2, v3, v4] -&gt; clockwise</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">p</span><span class="p">.</span><span class="nx">verts</span><span class="p">){</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="p">;</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">/=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">verts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">/=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">verts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">render_target</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&quot;rgba(32, 32, 150, 1.0)&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">verts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>          <span class="nx">render_target</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we have what is basically a list of vertecies. For this case we are going to use the Vertex object as a container for a point. All we are going to use is the x and y. After that we have a function to build the shape and draw it to the render_target, in our case the canvas.</p>

<h4>Lights</h4>

<p>Now we have lights. Lights need to have a position for use to direct the shadow. We are going to make it the lights job to manage the objects it is suppose to cast a shadow on. They will also be responsible for drawing the shadow and itself.</p>

<figure class='code'><figcaption><span>light</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">Light</span><span class="p">(</span><span class="nx">p</span><span class="p">){</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">pos</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">pos</span> <span class="o">||</span> <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">shine</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span> <span class="nx">render_target</span><span class="p">){</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// this is where I hold the value of whether an edge is hidden or visible.</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">edge_status</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// 0 for hidden : 1 for visible</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>          <span class="nx">edge_status</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">// get the side as a vector</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">i</span><span class="o">%</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">.</span><span class="nx">length</span><span class="p">].</span><span class="nx">x</span><span class="o">-</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">.</span><span class="nx">length</span><span class="p">].</span><span class="nx">x</span><span class="p">;</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">i</span><span class="o">%</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">.</span><span class="nx">length</span><span class="p">].</span><span class="nx">y</span><span class="o">-</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">.</span><span class="nx">length</span><span class="p">].</span><span class="nx">y</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">// take the center of the light and get the vector from the vertex to the light</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">nx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span>  <span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">i</span><span class="o">%</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">.</span><span class="nx">length</span><span class="p">].</span><span class="nx">x</span><span class="p">;</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">ny</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span>  <span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">i</span><span class="o">%</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">.</span><span class="nx">length</span><span class="p">].</span><span class="nx">y</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">// get surface normal vector or taking the vector at a 90 degree angle so we have a line shooting perpendicular to the edge</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">tv</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="o">-</span><span class="nx">dy</span><span class="p">,</span> <span class="nx">dx</span><span class="p">);</span> <span class="c1">// edge normal</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">nv</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="nx">nx</span><span class="p">,</span> <span class="nx">ny</span><span class="p">);</span>  <span class="c1">// ligt vector</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">dp</span> <span class="o">=</span> <span class="nx">DotProduct2</span><span class="p">(</span><span class="nx">tv</span><span class="p">,</span> <span class="nx">nv</span><span class="p">);</span>  <span class="c1">// the dot product or cosine</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">// less than 0 the edge is backfacing</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nx">dp</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">){</span>
</span><span class='line'>              <span class="nx">edge_status</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// get the corner vertexes :: we move counter clockwise and use the vector for the light to the vertex for the shadow</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">last_edge</span> <span class="o">=</span> <span class="nx">edge_status</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">corner_edges</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">s_e_vert</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">this_edge</span> <span class="o">=</span> <span class="nx">edge_status</span><span class="p">[(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">.</span><span class="nx">length</span><span class="p">];</span> <span class="c1">//block.verts[i];</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nx">last_edge</span> <span class="o">!=</span> <span class="nx">this_edge</span><span class="p">){</span>
</span><span class='line'>              <span class="nx">corner_edges</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">.</span><span class="nx">length</span><span class="p">].</span><span class="nx">x</span><span class="p">,</span> <span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">.</span><span class="nx">length</span><span class="p">].</span><span class="nx">y</span><span class="p">));</span>
</span><span class='line'>              <span class="nx">s_e_vert</span><span class="p">.</span><span class="nx">push</span><span class="p">((</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span class='line'>              <span class="c1">// last_edge = this_edge;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="nx">last_edge</span> <span class="o">=</span> <span class="nx">this_edge</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// display the shadow</span>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Amplify the vector</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">s_e_vert</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="nx">x</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">s_e_vert</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="nx">y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">t</span><span class="p">.</span><span class="nx">x</span> <span class="o">*=</span> <span class="mi">40</span><span class="p">;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">y</span> <span class="o">*=</span> <span class="mi">40</span><span class="p">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">s_e_vert</span><span class="p">[</span><span class="mi">1</span><span class="p">]].</span><span class="nx">x</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">s_e_vert</span><span class="p">[</span><span class="mi">1</span><span class="p">]].</span><span class="nx">y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*=</span> <span class="mi">40</span><span class="p">;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*=</span> <span class="mi">40</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// this is to display the shadow behind the block with respect to the light</span>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">s_e_vert</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="nx">x</span><span class="p">,</span> <span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">s_e_vert</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">s_e_vert</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="nx">x</span><span class="p">,</span> <span class="nx">t</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">s_e_vert</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">s_e_vert</span><span class="p">[</span><span class="mi">1</span><span class="p">]].</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">s_e_vert</span><span class="p">[</span><span class="mi">1</span><span class="p">]].</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">s_e_vert</span><span class="p">[</span><span class="mi">1</span><span class="p">]].</span><span class="nx">x</span><span class="p">,</span> <span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">s_e_vert</span><span class="p">[</span><span class="mi">1</span><span class="p">]].</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">s_e_vert</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="nx">x</span><span class="p">,</span> <span class="nx">block</span><span class="p">.</span><span class="nx">verts</span><span class="p">[</span><span class="nx">s_e_vert</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">radgrad</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">createRadialGradient</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">radgrad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgba(0, 0, 0, 1.0)&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">radgrad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="s1">&#39;rgba(16, 16, 16, 0.8)&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">radgrad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="s1">&#39;rgba(20, 20, 20, 0.5)&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">radgrad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rgba(0, 0, 0, 0.0)&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">radgrad</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">render_target</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">radgrad</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">createRadialGradient</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">radgrad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rgba(200, 200, 128, 1.0)&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">radgrad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;rgba(128, 128, 0, 0.5)&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">radgrad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;rgba(64, 64, 0, 0.0)&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">radgrad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rgba(0, 0, 0, 0.0)&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">radgrad</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">render_target</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So first things first this is a lot of code. At the end of the post I will include a link and a file for you to download all of it.</p>

<p>As far as the code goes the actual object has a position which is another vector for the x/y container. A shine function and a draw function. The shine function will cast a shadow on a block. The draw funciont will just draw the light. We are really just worried about the shine function which does basically all the heavy lifting of casting a shadow.</p>

<p>In the first for loop of the function we are just going through each vertex of the block and getting the edge normal. The edge normal is a line perpendicular to the edge. We get that by getting a vector for the edge and flipping it 90 degrees.</p>

<p><img src="/images/edge_normal.png" alt="edge normals" /></p>

<p>In the image above the red dots are the vertecies and the blue lines are outward are the edge normal for the respective edge they are touching. We take that normal and make a vector from the edge to the position of the light. We then take the dot product to get the cosine angle to get whether that edge is facing us or not. It is easy to eye ball. You can see in the image below.</p>

<p><img src="/images/edge_normal_light.png" alt="edge normals light" /></p>

<p>After we have found the status of each edge we iterate over the statuses to find which vertecies are the shadow vertecies. When using only <a href="http://en.wikipedia.org/wiki/Convex_and_concave_polygons">convex</a> we will be left with only two vertecies. It is these that we are going to take the vector from the light to this vertex and translate it from the vertex away from the light.</p>

<p><img src="/images/edge_shadow.png" alt="edge shadow" /></p>

<p>Once that is finished we just connect the two shadow vectors with lines and draw it. Then like magic we have a shadow cast from the light source. Luckily this is a pretty small function and doesn&#8217;t hit too hard. There is a bit more code for drawing a gradient. I left it in there so that it would match what is on <a href="https://github.com/beersbr/public_js/blob/master/dynamic_lighting.html">github</a></p>

<h3>The final steps</h3>

<p>Now really all that is left is to combine all the code bits into one big code byte (ha, nerd jokes). So lets build some object and shine a light at them to see if they cast a shadow.</p>

<figure class='code'><figcaption><span>instances</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">cvs</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">cvs</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">blocks</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// push our blocks into an array so we can iterate over them easily</span>
</span><span class='line'>  <span class="nx">blocks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
</span><span class='line'>      <span class="k">new</span> <span class="nx">Block</span><span class="p">({</span>
</span><span class='line'>          <span class="nx">verts</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>              <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span>
</span><span class='line'>              <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span>
</span><span class='line'>              <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
</span><span class='line'>              <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
</span><span class='line'>              <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="mi">225</span><span class="p">,</span> <span class="mi">275</span><span class="p">)</span>
</span><span class='line'>          <span class="p">]</span>
</span><span class='line'>      <span class="p">})</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">blocks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
</span><span class='line'>      <span class="k">new</span> <span class="nx">Block</span><span class="p">({</span>
</span><span class='line'>          <span class="nx">verts</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>              <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
</span><span class='line'>              <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="mi">190</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span>
</span><span class='line'>              <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="mi">165</span><span class="p">,</span> <span class="mi">170</span><span class="p">)</span>
</span><span class='line'>          <span class="p">]</span>
</span><span class='line'>      <span class="p">})</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">blocks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
</span><span class='line'>      <span class="k">new</span> <span class="nx">Block</span><span class="p">({</span>
</span><span class='line'>          <span class="nx">verts</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>              <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
</span><span class='line'>              <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
</span><span class='line'>              <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span>
</span><span class='line'>              <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
</span><span class='line'>          <span class="p">]</span>
</span><span class='line'>      <span class="p">})</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">l</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Light</span><span class="p">({</span><span class="nx">pos</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Vector2</span><span class="p">(</span><span class="mi">480</span><span class="p">,</span> <span class="mi">100</span><span class="p">)});</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">default_margin</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">cvs</span><span class="p">.</span><span class="nx">onmousemove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">l</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">-</span> <span class="nx">default_margin</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">l</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">-</span> <span class="nx">default_margin</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">640</span><span class="p">,</span><span class="mi">480</span><span class="p">);</span>   
</span><span class='line'>
</span><span class='line'>      <span class="nx">l</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="nx">ctx</span><span class="p">);</span>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">blocks</span><span class="p">){</span>
</span><span class='line'>          <span class="nx">l</span><span class="p">.</span><span class="nx">shine</span><span class="p">(</span><span class="nx">blocks</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">ctx</span><span class="p">);</span> <span class="c1">// shine is the function used to shine the light ( or calculate the shadows and draw them)</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// we want to draw the blocks over the shadows</span>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">blocks</span><span class="p">){</span>
</span><span class='line'>          <span class="nx">blocks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">draw</span><span class="p">(</span><span class="nx">ctx</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>First we grab the canvas then we build some blocks and shove them in an array. Then we attach a mouse move listener to the canvas where everytime the mouse is moved we update the shadows giving us a shadow that will change based on what position the light is in. The light will move based on where the mouse is.</p>

<ul>
<li>Here is your tinkerbin: <a href="http://tinkerbin.com/OHF3Nn5v">http://tinkerbin.com/OHF3Nn5v</a></li>
<li>Here is the public source: <a href="https://github.com/beersbr/public_js/blob/master/dynamic_lighting.html">https://github.com/beersbr/public_js/blob/master/dynamic_lighting.html</a></li>
</ul>


<p>That is about it. You can mess around with it. Next time I go over shadows I will cover how to build softer shadows, adding in the penumbra so that we dont have just a hard edge. Happy coding!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Brett Beers</span></span>

      








  


<time datetime="2011-12-06T16:38:00-07:00" pubdate data-updated="true">Dec 6<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/2d/'>2d</a>, <a class='category' href='/blog/categories/game-programming/'>game-programming</a>, <a class='category' href='/blog/categories/graphics/'>graphics</a>, <a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/programming/'>programming</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://beersbr.github.com/blog/2011/12/06/dynamic-lighting-in-2d/" data-via="mramaizng" data-counturl="http://beersbr.github.com/blog/2011/12/06/dynamic-lighting-in-2d/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/12/06/canvas-part-4/" title="Previous Post: Canvas part 4: A game loop">&laquo; Canvas part 4: A game loop</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2011/12/06/dynamic-lighting-in-2d/">Dynamic Lighting in 2d</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/12/06/canvas-part-4/">Canvas part 4: A game loop</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/26/canvas-part-3-dot-1-adding-audio/">Canvas part 3.1: Adding audio</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/24/canvas-part-3-a-change-in-direction/">Canvas part 3: A change in direction (or Images)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/23/canvas-part-2-shapes-and-stuff/">Canvas part 2: Shapes and stuff</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/beersbr">@beersbr</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'beersbr',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("mramaizng", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/mramaizng" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @mramaizng</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - Brett Beers -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'brettbeers';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://beersbr.github.com/blog/2011/12/06/dynamic-lighting-in-2d/';
        var disqus_url = 'http://beersbr.github.com/blog/2011/12/06/dynamic-lighting-in-2d/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
